<div class="h-full" id="set-password">
  <div class="text-center mb-8">
    <div class="flex items-center justify-center mb-4">
      <div class="relative">
        <img
          src="logo/logo-elab.png"
          alt="E-Landela Lab"
          height="80"
          class="relative z-10"
        />
      </div>
    </div>
    <p-divider></p-divider>
    <div class="mb-6 mt-6">
      <p class="text-gray-600 text-sm">
        Définissez votre mot de passe pour la connexion
      </p>
    </div>
  </div>

  <div [formGroup]="setPasswordForm">
    <div class="mb-6">
      <label for="oldPassword" class="flex font-medium mb-2 gap-2 items-center">
        {{ "Ancien mot de passe" }}</label
      >
      <div class="relative">
        <p-password
          id="oldPassword"
          class="w-full"
          formControlName="oldPassword"
          placeholder="Entrez votre ancien mot de passe"
          [style]="{ width: '100%' }"
          inputStyleClass="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
          [toggleMask]="true"
          [ngClass]="{
            'ng-invalid ng-dirty': oldPassword?.invalid
          }"
          [feedback]="false"
        >
        </p-password>
        <i
          class="fas fa-unlock text-base absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 z-10"
        ></i>
      </div>
      @if(oldPassword?.touched) {
      <div class="mt-1">
        <small
          class="p-error block text-red-500"
          *ngIf="oldPassword?.errors?.['required']"
        >
          {{ "Ancien mot de passe est requis" }}</small
        >
      </div>
      }
    </div>

    <div class="mb-6">
      <label for="password" class="flex font-medium mb-2 gap-2 items-center">
        {{ "Nouveau mot de passe" }}</label
      >
      <div class="relative">
        <p-password
          id="password"
          class="w-full"
          formControlName="password"
          placeholder="Entrez votre nouveau mot de passe"
          [style]="{ width: '100%' }"
          inputStyleClass="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
          [toggleMask]="true"
          [ngClass]="{
            'ng-invalid ng-dirty': password?.invalid
          }"
          [promptLabel]="'Entrer un mot de passe'"
          [weakLabel]="'Faible' "
          [mediumLabel]="'Moyen' "
          [strongLabel]="'Fort' "
          [feedback]="true"
        >
        </p-password>
        <i
          class="fas fa-lock text-base absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 z-10"
        ></i>
      </div>
      @if(password?.touched) {
      <div class="mt-1">
        <small
          class="p-error block text-red-500"
          *ngIf="password?.errors?.['required']"
        >
          {{ "Mot de passe est requis" }}</small
        >
        <small
          class="p-error block text-red-500"
          *ngIf="password?.errors?.['minlength']"
        >
          {{ "Le mot de passe doit contenir au moins 8 caractères" }}
        </small>
      </div>
      }
    </div>

    <div class="mb-6">
      <label
        for="confirmPassword"
        class="flex font-medium mb-2 gap-2 items-center"
      >
        {{ "Confirmer le mot de passe" }}</label
      >
      <div class="relative">
        <p-password
          id="confirmPassword"
          class="w-full"
          formControlName="confirmPassword"
          placeholder="Confirmez votre mot de passe"
          [style]="{ width: '100%' }"
          inputStyleClass="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
          [toggleMask]="true"
          [ngClass]="{
            'ng-invalid ng-dirty': confirmPassword?.invalid || setPasswordForm?.errors?.['passwordMismatch']
          }"
          [feedback]="false"
        >
        </p-password>
        <i
          class="fas fa-lock-open text-base absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 z-10"
        ></i>
      </div>
      @if(confirmPassword?.touched ||
      setPasswordForm?.errors?.['passwordMismatch']) {
      <div class="mt-1">
        <small
          class="p-error block text-red-500"
          *ngIf="confirmPassword?.errors?.['required']"
        >
          {{ "Confirmation du mot de passe est requise" }}</small
        >
        <small
          class="p-error block text-red-500"
          *ngIf="setPasswordForm?.errors?.['passwordMismatch'] && confirmPassword?.touched"
        >
          {{ "Les mots de passe ne correspondent pas" }}
        </small>
      </div>
      }
    </div>

    <p-button
      pRipple
      id="set-password-submit-button"
      [label]="'Définir le mot de passe' "
      styleClass="w-full py-3 font-semibold text-white "
[loading]="vm.loading()"
      [disabled]="setPasswordForm.invalid"
      (onClick)="setPassword()"
    />

    <div class="flex items-center justify-center mb-6">
      <p-button
        [label]="'Retour à la connexion'"
        [link]="true"
        id="backToLogin"
        (onClick)="goToLogin()"
        styleClass="text-blue-600 hover:text-blue-800 text-sm font-medium"
      />
    </div>

    <!-- Help Section -->
    <div class="mt-4 pt-4 border-t border-gray-200">
      <div class="text-center">
        <div class="flex items-center justify-center mb-3">
          <i class="fas fa-info-circle text-blue-500 mr-2"></i>
          <h3 class="text-sm font-semibold text-gray-700">
            Conseils de sécurité
          </h3>
        </div>
        <p class="text-xs text-gray-600 mb-3">
          Utilisez un mot de passe fort avec au moins 8 caractères, incluant des
          lettres, chiffres et symboles
        </p>
      </div>
    </div>
  </div>
</div>
